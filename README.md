# Taremin Mesh Combiner

## なにこれ？

モデルをUnityなどの環境用にエクスポートする前にメッシュオブジェクトのモディファイアを適用して結合するためのBlenderアドオンです。
対応しているBlenderのバージョンは2.80以降です。
具体的な機能は以下のとおりです。

- オブジェクトの結合
- 非表示のメッシュオブジェクトの削除
- グループ化機能による結合オブジェクトの振り分け
- 結合時に事前に設定した頂点に対して重複頂点の結合を行う
- 衣装を変えたときなどのためにアーマチュアレイヤーで選択されていない不必要なボーンを消す(頂点ウェイトも親のウェイトに追加)

このアドオンでは不要なオブジェクトなどの削除や結合などを行うため、念のため別のファイルに `コピーを保存` して、そちらのファイルで作業を行うことをおすすめします。


## インストール

[Releases](./releases) から最新の zip をダウンロードして、「ファイル」「ユーザー設定」「アドオン」「ファイルからアドオンをインストール」を選択し、ダウンロードした zip ファイルをインストールします。

![ダウンロード方法](images/how_to_download.png)

3D View: Taremin Mesh Combiner という項目がアドオン一覧に追加されるのでチェックボックスをオンにします。


## 使い方

![ツールパネル](images/toolpanel.png)

3Dビューの右のサイドバーに "Taremin" という項目が追加されているので選択します。


### シェイプキーを持つオブジェクトがある場合

Blenderではシェイプキーを持つオブジェクトはモディファイアを適用することができません。
そこで [Apply Modifier アドオン](https://sites.google.com/site/matosus304blendernotes/home/download) がインストールされている場合、このアドオンを使って適用します。

※Blender2.8 以上のサポートは元の作者さまの代わりに [私が対応したバージョン](https://github.com/Taremin/ApplyModifier) があるのでそちらを利用してください。


### グループ化

正規表現とコレクションによるグループ化によって、例えば服装やアクセサリなど複数のオブジェクトに結合することができます。
グループ化の設定の上から順にマッチしたものが適用されます。


#### 正規表現(Regexp)によるグループ化

正規表現によるグループ化は元のオブジェクト名を **置換して** 結合先のオブジェクト名にすることができ、その際に後方参照も利用することが出来ます。
利用可能な正規表現の詳しい説明については [Python3 の re モジュールのリファレンス](https://docs.python.org/ja/3/library/re.html) を参照してください。

例えば、以下のようなオブジェクトがあるとします。

```
 - 素体
 - 衣装_帽子
 - 衣装_手袋
 - 衣装_靴
```

このとき、衣装のパーツをそれぞれ `帽子`、`手袋`、`靴` に振り分けるには以下のようにします。

```
グループタイプ: 正規表現
正規表現: 衣装_(.*)
出力オブジェクト: \1
```

逆に `衣装` として一つのオブジェクトに結合したい場合は以下のようになります。

```
グループタイプ: 正規表現
正規表現: (衣装)_.*
出力オブジェクト: \1
```

この場合はもちろん後方参照 `\1` を使用せずに直接 `衣装` と書いても構いません。


#### コレクションによるグループ化

指定したコレクション以下のオブジェクトで結合することが出来ます。
コレクションによるグループ化は2種類あり、一つはそのコレクション直下のオブジェクトのみの `Collection`、もうひとつはそのコレクション以下の階層すべてのオブジェクトが対象となる `Collection (Recursive)` です。


### 結合後に重複頂点の削除行いたい場合

首から上を身体から分離している場合など、結合後に "重複頂点の削除"(距離でマージ) で結合を行いたい場合があります。
その場合、"重複頂点の削除" の対象としたい頂点で頂点グループを作成し、その名前の先頭に "Merge." を付けます。
結合処理後に "Merge." の付いてる頂点グループに対して自動的に "重複頂点の削除" が実行されます。
